<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chat History Feature</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="container mt-5">
        <h2><i class="fas fa-vial text-primary"></i> Test Chat History Feature</h2>
        <p class="text-muted">Ki·ªÉm tra t√≠nh nƒÉng l∆∞u tr·ªØ l·ªãch s·ª≠ chat t·ª± ƒë·ªông</p>

        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>üß™ Test Cases</h5>
                    </div>
                    <div class="card-body">
                        <div class="test-case mb-3">
                            <h6>‚úÖ 1. T√≠nh nƒÉng l∆∞u tr·ªØ t·ª± ƒë·ªông</h6>
                            <ul>
                                <li>M·ªói tin nh·∫Øn ƒë∆∞·ª£c l∆∞u t·ª± ƒë·ªông v√†o localStorage</li>
                                <li>Gi·ªõi h·∫°n 100 tin nh·∫Øn g·∫ßn nh·∫•t</li>
                                <li>L∆∞u timestamp cho m·ªói tin nh·∫Øn</li>
                            </ul>
                        </div>

                        <div class="test-case mb-3">
                            <h6>‚úÖ 2. Ph·ª•c h·ªìi l·ªãch s·ª≠ khi F5</h6>
                            <ul>
                                <li>L·ªãch s·ª≠ chat ƒë∆∞·ª£c t·∫£i l·∫°i sau khi refresh</li>
                                <li>Tin nh·∫Øn hi·ªÉn th·ªã ƒë√∫ng th·ª© t·ª± th·ªùi gian</li>
                                <li>Gi·ªØ nguy√™n format v√† style</li>
                            </ul>
                        </div>

                        <div class="test-case mb-3">
                            <h6>‚úÖ 3. Xu·∫•t l·ªãch s·ª≠ chat</h6>
                            <ul>
                                <li>Xu·∫•t file JSON v·ªõi to√†n b·ªô l·ªãch s·ª≠</li>
                                <li>Bao g·ªìm th√¥ng tin timestamp v√† lo·∫°i tin nh·∫Øn</li>
                                <li>T√™n file c√≥ ng√†y th√°ng</li>
                            </ul>
                        </div>

                        <div class="test-case mb-3">
                            <h6>‚úÖ 4. Th·ªëng k√™ chat</h6>
                            <ul>
                                <li>ƒê·∫øm t·ªïng s·ªë tin nh·∫Øn</li>
                                <li>Ph√¢n lo·∫°i tin nh·∫Øn ng∆∞·ªùi d√πng/AI</li>
                                <li>Hi·ªÉn th·ªã th·ªùi gian b·∫Øt ƒë·∫ßu v√† g·∫ßn nh·∫•t</li>
                            </ul>
                        </div>

                        <div class="test-case mb-3">
                            <h6>‚úÖ 5. X√≥a l·ªãch s·ª≠ an to√†n</h6>
                            <ul>
                                <li>X√°c nh·∫≠n tr∆∞·ªõc khi x√≥a</li>
                                <li>X√≥a ho√†n to√†n kh·ªèi localStorage</li>
                                <li>Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>üîß Quick Tests</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="/agent" class="btn btn-primary">
                                <i class="fas fa-robot me-1"></i>M·ªü AI Agent
                            </a>
                            <button class="btn btn-outline-info" onclick="checkLocalStorage()">
                                <i class="fas fa-database me-1"></i>Ki·ªÉm tra localStorage
                            </button>
                            <button class="btn btn-outline-warning" onclick="simulateMessages()">
                                <i class="fas fa-comments me-1"></i>T·∫°o tin nh·∫Øn test
                            </button>
                            <button class="btn btn-outline-danger" onclick="clearTestData()">
                                <i class="fas fa-trash me-1"></i>X√≥a d·ªØ li·ªáu test
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h6>üìä Storage Info</h6>
                    </div>
                    <div class="card-body">
                        <div id="storageInfo">
                            <small class="text-muted">ƒêang t·∫£i...</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="alert alert-info mt-4">
            <h6><i class="fas fa-info-circle me-2"></i>H∆∞·ªõng d·∫´n test:</h6>
            <ol>
                <li>M·ªü AI Agent v√† g·ª≠i v√†i tin nh·∫Øn</li>
                <li>Nh·∫•n F5 ƒë·ªÉ refresh trang</li>
                <li>Ki·ªÉm tra xem l·ªãch s·ª≠ c√≥ ƒë∆∞·ª£c ph·ª•c h·ªìi kh√¥ng</li>
                <li>Th·ª≠ xu·∫•t l·ªãch s·ª≠ v√† xem th·ªëng k√™</li>
                <li>Test x√≥a l·ªãch s·ª≠</li>
            </ol>
        </div>
    </div>

    <script>
        // Check localStorage data
        function checkLocalStorage() {
            const chatHistory = localStorage.getItem('aiAgentChatHistory');
            if (chatHistory) {
                const history = JSON.parse(chatHistory);
                alert(`üíæ LocalStorage Info:
‚Ä¢ S·ªë tin nh·∫Øn: ${history.length}
‚Ä¢ K√≠ch th∆∞·ªõc: ${(JSON.stringify(history).length / 1024).toFixed(1)} KB
‚Ä¢ Tin nh·∫Øn ƒë·∫ßu: ${history[0]?.timestamp || 'N/A'}
‚Ä¢ Tin nh·∫Øn cu·ªëi: ${history[history.length - 1]?.timestamp || 'N/A'}`);
            } else {
                alert('‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu chat trong localStorage');
            }
        }

        // Simulate test messages
        function simulateMessages() {
            const testMessages = [
                { message: 'Xin ch√†o AI Agent!', type: 'user', timestamp: new Date().toISOString() },
                { message: 'Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?', type: 'ai', timestamp: new Date().toISOString() },
                { message: 'G·ª£i √Ω m√≥n ƒÉn healthy cho t√¥i', type: 'user', timestamp: new Date().toISOString() },
                { message: 'T√¥i g·ª£i √Ω c√°c m√≥n ƒÉn healthy nh∆∞: salad, c√° h·ªìi n∆∞·ªõng, s√∫p rau...', type: 'ai', timestamp: new Date().toISOString() }
            ];

            localStorage.setItem('aiAgentChatHistory', JSON.stringify(testMessages));
            alert('‚úÖ ƒê√£ t·∫°o ' + testMessages.length + ' tin nh·∫Øn test!');
            updateStorageInfo();
        }

        // Clear test data
        function clearTestData() {
            if (confirm('X√≥a to√†n b·ªô d·ªØ li·ªáu test?')) {
                localStorage.removeItem('aiAgentChatHistory');
                alert('üóëÔ∏è ƒê√£ x√≥a d·ªØ li·ªáu test!');
                updateStorageInfo();
            }
        }

        // Update storage info display
        function updateStorageInfo() {
            const chatHistory = localStorage.getItem('aiAgentChatHistory');
            const darkMode = localStorage.getItem('darkMode');

            let info = '<div class="small">';

            if (chatHistory) {
                const history = JSON.parse(chatHistory);
                info += `<div><strong>Chat History:</strong></div>`;
                info += `<div>‚Ä¢ ${history.length} tin nh·∫Øn</div>`;
                info += `<div>‚Ä¢ ${(JSON.stringify(history).length / 1024).toFixed(1)} KB</div>`;
            } else {
                info += `<div>‚Ä¢ Ch∆∞a c√≥ l·ªãch s·ª≠ chat</div>`;
            }

            info += `<div class="mt-2"><strong>Other:</strong></div>`;
            info += `<div>‚Ä¢ Dark mode: ${darkMode || 'false'}</div>`;
            info += '</div>';

            document.getElementById('storageInfo').innerHTML = info;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            updateStorageInfo();
            setInterval(updateStorageInfo, 2000); // Update every 2 seconds
        });
    </script>
</body>

</html>